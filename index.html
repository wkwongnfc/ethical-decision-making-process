<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethical Decision-Making</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* Enforces a 4:3 aspect ratio on the main container */
        .aspect-4-3 {
            aspect-ratio: 4 / 3;
        }

        .droppable-item.highlight {
            background-color: #d1fae5;
            border-color: #10b981;
        }

        .feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .feedback-correct {
            background-color: #10b981;
            color: white;
        }

        .feedback-incorrect {
            background-color: #ef4444;
            color: white;
        }

        .draggable-item:active {
            cursor: grabbing;
        }

        .flow-arrow {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d1d5db;
        }
        
        .flow-arrow::after {
            content: '→';
            font-size: 1.5rem;
            line-height: 1;
        }

        .flow-arrow-down::after {
            content: '↓';
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-2">

    <div class="w-full sm:max-w-4xl p-6 bg-white rounded-xl shadow-lg flex flex-col items-center aspect-4-3">
        <!-- Header: Title and Reset Button -->
        <div class="flex justify-between items-start w-full mb-6">
            <h1 class="text-xs sm:text-2xl font-semibold text-left mr-4">
                Which of the following shows the correct order of the 5-step process of making an ethical decision?
            </h1>
            <button id="reset-button" class="px-2 py-1 sm:px-6 sm:py-3 bg-blue-500 text-white font-bold rounded-full shadow-md transition-transform transform hover:scale-105 active:scale-95 text-xs shrink-0">
                Reset
            </button>
        </div>
        
        <!-- Draggable Options in a row -->
        <div id="drag-container" class="flex flex-wrap justify-center gap-1 sm:gap-4 mb-8 w-full">
            <!-- Draggable items will be populated by JavaScript -->
        </div>

        <!-- Workflow Drop Zones -->
        <div class="flex flex-col items-center w-full">
            <div id="drop-container-top-row" class="flex flex-row justify-center items-center flex-wrap gap-1 sm:gap-4 w-full"></div>
            
            <div id="drop-container-bottom-row" class="flex flex-row justify-center items-center flex-wrap gap-1 sm:gap-4 w-full mt-4"></div>
        </div>
    </div>

    <!-- Floating Feedback Message -->
    <div id="feedback" class="feedback-message"></div>

    <script>
        const STEPS_DATA = [
            { id: 'step-1', text: 'Have a clear understanding of the situation' },
            { id: 'step-2', text: 'Identify the stakeholders' },
            { id: 'step-3', text: 'Prioritise the key responsibilities' },
            { id: 'step-4', text: 'Identify a course of action' },
            { id: 'step-5', text: 'Act on it and review' },
        ];

        const COLORS = [
            'bg-blue-500', 
            'bg-green-500', 
            'bg-purple-500', 
            'bg-red-500', 
            'bg-yellow-500'
        ];

        const dropContainerTop = document.getElementById('drop-container-top-row');
        const dropContainerBottom = document.getElementById('drop-container-bottom-row');
        const dragContainer = document.getElementById('drag-container');
        const resetButton = document.getElementById('reset-button');
        const feedbackElement = document.getElementById('feedback');
        let draggedElement = null;

        // Function to shuffle an array (Fisher-Yates shuffle algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Creates the drop zones as a workflow diagram
        function createDropZones() {
            dropContainerTop.innerHTML = '';
            dropContainerBottom.innerHTML = '';
            STEPS_DATA.forEach((step, index) => {
                const dropZone = document.createElement('div');
                dropZone.classList.add('droppable-item', 'w-20', 'h-16', 'sm:w-[200px]', 'sm:h-24', 'p-1', 'sm:p-2', 'bg-gray-100', 'rounded-lg', 'border-2', 'border-dashed', 'border-gray-300', 'flex', 'items-center', 'justify-center', 'text-center', 'text-gray-500', 'shrink-0');
                dropZone.dataset.step = step.id;
                dropZone.innerHTML = `<span class="font-bold text-xs sm:text-xl">${index + 1}.</span> <span class="placeholder-text text-[8px] sm:text-sm ml-1 sm:ml-2">Drop a step here...</span>`;
                
                if (index < 3) {
                    dropContainerTop.appendChild(dropZone);
                    if (index < 2) {
                        const arrow = document.createElement('div');
                        arrow.classList.add('flow-arrow', 'flex');
                        dropContainerTop.appendChild(arrow);
                    }
                } else {
                    dropContainerBottom.appendChild(dropZone);
                    if (index < STEPS_DATA.length - 1) {
                        const arrow = document.createElement('div');
                        arrow.classList.add('flow-arrow', 'flex');
                        dropContainerBottom.appendChild(arrow);
                    }
                }
            });
        }

        // Creates the draggable items and shuffles their order
        function createDraggableItems() {
            dragContainer.innerHTML = '';
            const shuffledSteps = shuffleArray([...STEPS_DATA]);
            shuffledSteps.forEach((step, index) => {
                const draggableItem = document.createElement('div');
                draggableItem.classList.add(
                    'draggable-item', 
                    'w-20', /* Standardized width */
                    'h-16', /* Standardized height */
                    'sm:w-[200px]', /* Standardized width */
                    'sm:h-24', /* Standardized height */
                    'p-1', 
                    'text-white', 
                    'font-medium',
                    COLORS[index % COLORS.length], 
                    'rounded-lg', 
                    'shadow-md', 
                    'border', 
                    'border-gray-200', 
                    'cursor-grab', 
                    'transition-transform', 
                    'transform', 
                    'hover:scale-105',
                    'flex', /* Added flex to center content */
                    'items-center',
                    'justify-center',
                    'text-center',
                    'text-[9px]', /* Small text for mobile */
                    'sm:text-base' /* Larger text for desktop */
                );
                draggableItem.textContent = step.text;
                draggableItem.draggable = true;
                draggableItem.id = step.id;
                dragContainer.appendChild(draggableItem);
            });
        }

        // Displays a floating feedback message
        function showFeedback(message, isCorrect) {
            feedbackElement.textContent = message;
            feedbackElement.classList.remove('feedback-correct', 'feedback-incorrect');
            feedbackElement.classList.add(isCorrect ? 'feedback-correct' : 'feedback-incorrect');
            feedbackElement.style.opacity = '1';

            setTimeout(() => {
                feedbackElement.style.opacity = '0';
            }, 1000);
        }

        // Checks if all items are in the correct drop zones
        function checkCompletion() {
            const allDropZones = document.querySelectorAll('.droppable-item');
            const allCorrect = Array.from(allDropZones).every(zone => {
                const child = zone.querySelector('.draggable-item');
                return child && child.id === zone.dataset.step;
            });
            if (allCorrect) {
                showFeedback("Congratulations! You've got it!", true);
            }
        }

        // Sets up the drag-and-drop and touch event listeners
        function setupDragAndDrop() {
            document.querySelectorAll('.draggable-item').forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedElement = e.target;
                    e.dataTransfer.setData('text/plain', e.target.id);
                    e.target.style.opacity = '0.5';
                });

                item.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '1';
                });

                // Touch event listeners for mobile devices
                item.addEventListener('touchstart', (e) => {
                    draggedElement = e.target;
                    e.target.style.opacity = '0.5';
                });

                item.addEventListener('touchend', (e) => {
                    const touch = e.changedTouches[0];
                    const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
                    
                    // Re-enable drag functionality after touch ends
                    if (draggedElement) {
                        draggedElement.style.opacity = '1';
                    }

                    if (draggedElement && dropTarget) {
                        const dropZone = dropTarget.closest('.droppable-item');
                        if (dropZone) {
                            if (dropZone.querySelector('.draggable-item')) {
                                showFeedback("Try again!", false);
                                return;
                            }
                            
                            if (draggedElement.id === dropZone.dataset.step) {
                                const number = dropZone.querySelector('.font-bold');
                                const placeholder = dropZone.querySelector('.placeholder-text');
                                if (number) number.remove();
                                if (placeholder) placeholder.remove();
                                
                                dropZone.appendChild(draggedElement);
                                draggedElement.draggable = false;
                                draggedElement.classList.remove('cursor-grab', 'hover:scale-105');
                                draggedElement.classList.add('cursor-default');
                                showFeedback("You are right!", true);
                                checkCompletion();
                            } else {
                                showFeedback("Try again!", false);
                            }
                        }
                    }
                    draggedElement = null;
                });
            });

            document.querySelectorAll('.droppable-item').forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (!zone.querySelector('.draggable-item')) {
                        zone.classList.add('highlight');
                    }
                });

                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('highlight');
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('highlight');
                    const droppedItemId = e.dataTransfer.getData('text/plain');
                    const droppedItem = document.getElementById(droppedItemId);

                    if (zone.querySelector('.draggable-item')) { 
                        showFeedback("Try again!", false);
                        return;
                    }
                    
                    if (droppedItem.id === zone.dataset.step) {
                        const number = zone.querySelector('.font-bold');
                        const placeholder = zone.querySelector('.placeholder-text');
                        if (number) number.remove();
                        if (placeholder) placeholder.remove();

                        zone.appendChild(droppedItem);
                        droppedItem.draggable = false;
                        droppedItem.classList.remove('cursor-grab', 'hover:scale-105');
                        droppedItem.classList.add('cursor-default');
                        showFeedback("You are right!", true);
                        checkCompletion();
                    } else {
                        showFeedback("Try again!", false);
                    }
                });
            });
        }

        function init() {
            createDropZones();
            createDraggableItems();
            setupDragAndDrop();
        }

        resetButton.addEventListener('click', () => {
            init();
        });

        // Initialize the activity on page load
        window.onload = init;
    </script>
</body>
</html>
